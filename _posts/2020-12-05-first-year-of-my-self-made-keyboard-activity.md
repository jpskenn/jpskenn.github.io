---
layout: post
title: "自キ活1年目で出来たものと、総当たりマトリクスのご紹介"
date: 2020-12-05
---

この記事は [キーボード #2 Advent Calendar 2020](https://adventar.org/calendars/5307) の、5日目の記事です。

前の記事は、s-showさんの”[自作キーボードについて考えていることなど]()”でした。  
次の記事は、eswaiさんの”[今年やったことのまとめ]()”です。


## 自キ活1年目で出来たものと、総当たりマトリクスのご紹介。

この1年は、僕にとっての自作キーボード元年でした。  
自作キーボードの世界に出会い、キットの製作から始めて、オリジナルのケースやキープレートの製作、そして基板の製造までやれるようになった1年をふりかえります。  
また、自設計キーボード”Colice”の設計・調査中に偶然（？）発見した総当たりマトリクスについても紹介します。


### 自己紹介

2020年現在、40歳代の中盤。  
情報処理系の学部をゆっくり卒業してソフトウェア開発会社に就職したけど、Javaをちゃんと理解する前になんだかしんどくなってやめちゃった人。  
今は華の事務職。

Java、Perl、VBAあたりの開発言語はわかるけど、他はあんまり…  
QMKのCは、なんとなくでやっています。  
gitとかよくわかんないし、QMKのプルリク（？）は怖くて手が出せていません。

電気・電子回路など、ハード面の知識はほぼゼロ。  
LEDの抵抗の計算は2019年11月に初めてやりました。

### 自キとの出会い

大学生の頃からキーボードに興味があり、ヤフオクでIBM Model Mを手に入れたり、計算機室にあったX端末のキーボードに惚れ込んだりしていました。

社会人になってしばらくはIBMのSpace Saver Keyboard IIを使っていましたが、英語配列のRealforce 101が発売されると割と早めに手に入れていました。また、ソフトウェア開発会社ではHHKB Professionalを使っていました。

事務職になってからはテンキー付きのRealforce 101を愛用していましたが、長年の使用でくたびれてきたためRealforce R2 静音30gに乗り換えて大満足しました。  
その大満足を受け、家のMacで使っていたLogicool K480のひどい打鍵感をなんとかしたく、ネットを彷徨って見つけたのが自作キーボードでした。

市販品のErgoDoxやKinesisのFreestyleなどとも比較しつつ、分割型で、左手でYを打鍵する癖（現在は矯正済み）に対応できる両手7列、エルゴノミクスを感じる配列で選んだのは、ErgoDashでした。

### 自キ活1年目で出来たもの

この1年で出来上がったものを紹介します。

#### 左右分離型自作キーボード ErgoDash, 2019/11中旬

遊舎工房の通販でErgoDashを注文。  
スイッチとキーキャップはAliExpressで注文するなど、冒険しつつ安く抑えようとしていました。  

![初めての自作キーボード、ErgoDash](/assets/2020-12-05/IMG_0611.jpeg)

Mill-Maxソケットでソケット化する工夫を入れたり、アンダーグローLEDを基板のおもて面につける定番のミスをきっちりやって、ハードを完成させました。  

当時はmacOS Catalinaがリリースされた直後で、[Catalina上でQMKのファームウェアを書き込めないトラブル](https://github.com/qmk/qmk_firmware/issues/6133)が発生していました。トラブルの回避策にたどり着き、ようやくファームウェアを書き込めたのは、ハード完成から数日後でした。

初めてのキット組み立てでは、自作キーボードがどういう部品で構成されてどのように組み立てられるのか、またそれを動かすファームウェアの基本的な知識を学びました。

#### ErgoDash用パームレスト一体型ハイプロアクリルケース, 2019年12月上旬〜下旬

ErgoDash完成から1週間ほどで、純正のケースだとキーキャップ下側の角に手が引っかかるのが気になりはじめました。  
そこでキーキャップの周りにフレームをつけたハイプロケースを作成することにしました。

MacのAffinity Designerで図面を作り、アクリルのレーザーカットを依頼しましたが、最初に届いたものは[75%スケール](https://raw.githubusercontent.com/jpskenn/jpskenn.github.io/master/assets/2020-12-05/IMG_0624.jpeg)で仕上がっていて、愕然としました。  
出力した図面のdpiが間違っていたので、96dpiで図面を出力して再依頼しました。  

![ErgoDash用パームレスト一体型ハイプロアクリルケース](/assets/2020-12-05/IMG_0631.jpeg)

完成したケースは美しく、高さ調整式のパームレストで打鍵しやすくなりました。

ケース図面の描き方、キースイッチなどのサイズ、図面の出力は96dpiということを学び、誤発注の怖さを知りました。


#### SU120基板発注, 2019年12月末
ErgoDashを使い込むうちに自分用のキーボードを作りたくなり、何か始めようと動きだしました。  
この時点では知識が圧倒的に不足していたため、[過去のアドベントカレンダー](https://scrapbox.io/self-made-kbds-ja/アドベントカレンダー)や、foostan氏の”[自作キーボード設計入門](https://booth.pm/ja/items/1044084)”を読みまくり、自キとその周辺の知識を吸収していました。

ハード面の知識がないため「基板設計は難しそうだし、自分にはできそうにないなぁ」と思っていましたが、2019年のアドベントカレンダーでe3w2q氏の”[レイアウトを試行錯誤しやすくするために作った自作キーボード用基板の開発で試行錯誤した話](https://e3w2q.github.io/7/)”を見つけ、自由なレイアウトが作れるSU120の存在を知って「これならできるかも…」という気分になりました。  


![Elecrowから到着したSU120 Rev.7基板](/assets/2020-12-05/IMG_0889.jpeg)
そしてなんと、嬉しいことにSU120の基板データがGitHubで公開されていたので、恐る恐るElecrowへ発注しました。  
送料をケチって発送方法をRegistered Mailにしたら、注文から到着まで約25日かかり、2020年1月下旬まで待たされました。  


過去のアドベントカレンダーには先達の知識が詰まっていることを学びました。  
また、財布が許す限り、可能な限り早く受け取れる発送方法を選ぶのが、製作スピードとモチベーションを維持させることを体感しました。  

#### 改造キーボード [NumAtreus_Plus8](https://github.com/jpskenn/NumAtreus_Plus8), 2020年1月

遊舎工房の福袋に入っていた[NumAtreus](https://yushakobo.jp/shop/numatreus-kit/)。  

どう考えても40%キーボードを使える気がしないので、メルカリにでも出そうかと3日ほど悩みました。  
結局、NumAtreus（または沼人の会）と遊舎工房は使徒だったのだと思うようになり（？？？）、左右に1列増やす改造を加えて作成しました。

![NumAtreus Plus8](/assets/2020-12-05/DSC_6824.jpeg)
入門書片手に、KiCadでキープレート兼ベースプレートを設計しました。  
サリチル酸氏の”[PCBのマスクとシルクでオリジナルプレートを作ろう！](https://salicylic-acid3.hatenablog.com/entry/introduction_to_pcb_design)”を参考に、赤レジストに首里城とシーサーのイラストをつけて発注しました。  
（発送方法をOCS/ANAにしたら、SU120より先に到着しました）


この改造では、キーボードを低くする構造や、ProMicroのピンの使い方とそれに合わせたQMKファームウェアの作り方についての知識が深まりました。  
また、小さな部品の半田付け技術が少し向上しました。




#### 自分用に設計したキーボード [Colice（コリス）](https://github.com/jpskenn/Colice), 2020年1月〜5月
一体型かつ分離型で、左手、右手とテンキーの位置をを変えられるカラムスタガなAlice風配列のキーボード、Coliceを製作しました。  
自分で作る自分用のキーボードです。

![Colice, SU120によるプロト版](/assets/2020-12-05/IMG_0987.jpeg)
SU120を使って作成した、一体型のプロト版。  
約5度の傾斜角をつけた段ボールに乗せて、普段使いしながらレイアウトを試していました。  
この頃はProMicroを2個使用し、分割型をくっつけた状態でした。

![Colice, 完成](/assets/2020-12-05/DSC_6907.jpeg)
合体構造を試行錯誤したり、総当たりマトリクスを採用したり、トップマウント構造に難儀したり、基板やケースの試作をおこなったり…  
製作開始から5ヶ月で完成に至りました。  

キーやスタビライザーのサイズ、ケース構造、回路の設計、QMKファームウェアなど、自キ全般の知識と理解が深まり、製作に使用するKiCadやグラフィックツールなどの習熟度も上がりました。

また、少し大袈裟ですが、利用シーンや機能、アピール性など、モノとしての企画を管理、処理していくプロジェクトの進め方についても、多少は身についた感じがします。



#### 総当たりマトリクスを採用したキーボード [Atreus RR](https://github.com/jpskenn/AtreusRR), 2020年3月

ColiceをProMicro1個だけで動作させようと調べていて、2019年のアドベントカレンダーから以下の記事にたどり着きました。

- e3w2q氏の”[Duplex-Matrixを自作キーボードで使う方法](https://e3w2q.github.io/8/)”
- IKeJI氏の”[キーボードのマトリクス方式の分類](https://blog.ikejima.org/make/keyboard/2019/12/14/keyboard-circuit.html)”

12月には読んでいたはずの記事ですが、その当時の僕には理解できていなかったようです。

SU120で雑に動作確認して、2乗マトリクスでNumAtreus_Plus8を作り直してみました。  
**見事に失敗しました。**  
特定のキーでゴーストが発生し、使い物になりませんでした。

![NumAtreus_Plus8 RR, 手配線](/assets/2020-12-05/IMG_1353.jpeg)
**奇跡的に不具合を回避する方法を発見（※）**し、総当たりマトリクスを採用したAtreus RRが完成しました。

※：詳しくは後述の”総当たりマトリクスのご紹介”を参照


QMKファームウェアで独自マトリクスを使う方法を覚え、総当たりマトリクスが使えるようになりました。




#### ロースタガとオルソリニアを組み合わせた、GH60型ケース互換の60%キーボード [Jones](https://github.com/jpskenn/Jones), 2020年5月末〜現在


通常のロースタガ配列でそこそこ満足という気持ちと、左右対象じゃなかったり、右手のModキーが遠かったりするのを改善したいという想いから、必要にして十分な60%サイズのキーボード、Jonesを作りました。  


![Jones v.0.3.1 w/ KBDfans 5° Case](/assets/2020-12-05/DSC_7266.jpeg)
GH60型ケース互換にすることでケース設計の負担が軽減でき、約1ヶ月でv.0.1が完成しました。  

回路と基板はai03氏の”[PCB Designer Guide](https://wiki.ai03.com/books/pcb-design/chapter/pcb-designer-guide)”を参考にし、2音同時発音のスピーカーや、2個のロータリーエンコーダを搭載できるよう、総当たりマトリクスを採用しています。  

実際に使ってみると、右手のModが近いので打鍵が非常に楽になりました。  
あまりにも具合が良いので会社へ持っていったところ、Realforce R2 静音30gがスタメンを外れてしまいました…すごいぞJones。

![Jones v.0.3 JPスタイル w/ 60%プラスチックケース](/assets/2020-12-05/DSC_7205.jpeg)

v.0.3からはJPスタイルのレイアウトも選べるようになり、上下逆のISOエンターで周りへのアピール度も高まりました。

その気になれば、さらっと曲を演奏したりもできます。
<blockquote class="twitter-tweet" data-dnt="true"><p lang="ja" dir="ltr">Gimme! Gimme! Gimme!<a href="https://twitter.com/hashtag/Jones_kbd?src=hash&amp;ref_src=twsrc%5Etfw">#Jones_kbd</a> <a href="https://t.co/frBi9FMDjq">pic.twitter.com/frBi9FMDjq</a></p>&mdash; Takeshi Nishio (@jpskenn) <a href="https://twitter.com/jpskenn/status/1319242096478310400?ref_src=twsrc%5Etfw">October 22, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

〓学び

#### STM32F303評価ボード [STMeishi](https://github.com/jpskenn/STMeishi), 2020年11月

大きなサイズのファームウェアが使いたくなり、STM32F303を使ってみようと評価用に作成した名刺サイズのマクロパッドです。

![STMeishi v.1](/assets/2020-12-05/IMG_2025.jpeg)
電源LEDが点灯するだけで、ひとっつも動作しません。  
ああああああああ…  
（USBブートできない。っていうかMCUが動作してるのかさえわからないです。）

### 総当たりマトリクスのご紹介


### まとめ
アドカレは一つの夢
サンボを聴け
「売ってないから、自分で作る」という、とても単純なことを本気でやった製作
---

この記事は、自分で設計した[Jones](https://github.com/jpskenn/Jones)(v.0.3.1)のANSIスタイルをKBDfans 5°ケースと組み合わせ、流れるレインボーを見ながら書きました。
